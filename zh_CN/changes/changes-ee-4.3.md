---
# 编写日期
date: 2020-02-07 17:15:26
# 作者 Github 名称
author: wivwiv
# 关键字
keywords:
# 描述
description:
# 分类
category:
# 引用
ref:
---

# 版本发布

## 4.3.10 版本

*发布日期: 2022-06-01*

### 功能增强

- 为规则引擎 SQL 增加更多的时间转换函数
- 为规则引擎 SQL 增加 `float2str/2` 函数，支持指定浮点输出精度
- 规则引擎支持使用 Basic 和 JWT 认证连接 Pulsar
- 规则引擎 Oracle 资源新增 `service_name` 选项以支持 Oracle Database RAC
- 支持将 JWT 用于鉴权，现在 MQTT 客户端可以使用包含发布订阅白名单的特定声明进行授权
- 改进认证相关指标使更易理解，现在 `client.authenticate = client.auth.success + client.auth.failure`
- 支持 REST API 的监听器绑定到指定的网卡接口上
- 上传 License 将自动同步至整个集群，无需每个节点单独上传，提供 HTTP API
- 支持对使用内置数据库作为数据源的认证鉴权中的用户数据进行多条件查询和模糊查询
- 支持将消息队列长度以及丢弃消息数量作为条件查询客户端
- 支持配置日志时间格式以兼容旧版本中的时间格式
- 当 `use_username_as_clientid` 配置为 `true` 且客户端连接时未指定 `username`，现在将拒绝连接并返回 `Client Identifier not valid` 原因码
- 提高 AppSecret 的随机性能
- 现在不兼容版本之间的热升级将被拒绝
- 现在 EMQX 的启动路径将允许包含空格
- 增加对节点名称的检查

### 错误修复

- 修复使用 PostgreSQL 离线消息插件时客户端上线后获取不到消息的问题
- 修复某些情况下规则引擎无法与 Pulsar 成功建立 TLS 连接的问题
- 修复规则引擎 SQL 函数 `hexstr_to_bin/1` 无法处理半字节的问题
- 修复规则引擎资源删除时告警未被清除的问题
- 修复 Dashboard HTTPS 监听器的 `verify` 选项未生效的问题
- 修复共享订阅投递 QoS 1 消息时未正确处理客户端会话关闭的情况而导致消息丢失的问题
- 修复日志跟踪功能跟踪大报文时堆大小增长过快而触发连接进程强制关闭策略的问题
- 修复模块禁用时未正确卸载相关钩子导致功能异常的问题
- 修复 MQTT-SN 客户端重传 QoS 2 消息时会被断开连接的问题
- 修复备份文件中关闭的模块会在恢复备份后自动启用的问题
- 修复对订阅进行多条件查询时返回结果与查询条件不符的问题
- 修复规则引擎资源连接测试不工作的问题
- 修复多项 Dashboard 显示问题

## 4.3.9 版本

*发布日期: 2022-04-18*

### 功能增强

- 编解码现已支持使用 gRPC 服务将任意二进制有效负载解码为 JSON 数据
- 支持使用 TLS 连接到 Pulsar
- 规则引擎 SQL 新增 `mongo_date` 函数，支持将时间戳保存为 MongoDB Date 对象
- 规则引擎支持拷贝规则以快速复用
- 规则引擎 SQL 支持 zip、gzip 等压缩和解压缩函数
- 改进规则引擎在解析 Payload 失败时的错误提示
- 优化规则引擎部分资源的连接测试
- 支持为 ExHook 设置执行优先级
- ExHook 回调接口新增 `RequestMeta meta` Protobuf 字段用于返回 EMQX 集群名称
- 为共享订阅添加 `local` 策略，这将优先向消息流入的节点下的共享订阅者发送消息。在某些场景下会提升共享消息调度的效率，尤其是在 MQTT 桥接配置为共享订阅时
- 为 TLS 新增对 `RSA-PSK-AES256-GCM-SHA384`、`RSA-PSK-AES256-CBC-SHA384`、`RSA-PSK-AES128-GCM-SHA256`、`RSA-PSK-AES128-CBC-SHA256` 四个 PSK 加密套件的支持，从默认配置中移除 `PSK-3DES-EDE-CBC-SHA` 和 `PSK-RC4-SHA` 这两个不安全的加密套件
- 打印 Mnesia `wait_for_table` 诊断日志
  - 打印 Mnesia 内部统计的检查点
  - 打印每个表加载统计的检查点，帮助定位表加载时间长的问题
- 严格模式下禁止订阅为空的主题
- 当 `loaded_modules` 和 `loaded_plugins` 文件不存在时生成默认文件

### 错误修复

- 修复 TLS 配置项 `server_name_indication` 设置为 disable 不生效的问题
- 修复 MongoDB 驱动潜在的进程泄漏问题
- 修复通过 CLI 命令修改的 Dashboard 默认用户的密码会在节点离开集群后重置的问题
- 静默 `docker-entrypoint.sh` 中的 grep 和 sed 命令的运行错误日志
- 修复 API 路径包含 ISO8859-1 转义字符时，备份文件无法被正确删除和下载
- 修复 Redis 驱动在 DNS 解析失败等情况下会引发崩溃的问题
- 修复 MQTT Bridge 插件仅配置订阅主题但未配置 QoS 时无法启动的问题
- 创建规则时如果已经有使用相同 ID 的规则存在，现在规则引擎将报错而不是替换已有规则
- 修复 HTTP 驱动进程池可能无法删除的问题
- 修复模块参数更改报错后无法再次更新的问题
- 修复 Dashboard 中 GB/T 32960 接入网关模块部分字段类型错误问题
- 修复 Kafka、Pulsar 等 Bridge 资源的配置无法更新的问题
- 修复启用匿名认证时 JT/T 808 客户端认证失败的问题

## 4.3.8 版本

*发布日期: 2022-04-01*

### 重要变更

- 对于 Docker 镜像，配置目录 `/opt/emqx/etc` 已经从 VOLUME 列表中删除，这使用户可以更容易地使用更改后的配置来重建镜像。
- CentOS 7 Erlang 运行系统在 OpenSSL-1.1.1n（之前是 1.0）上重建，在 v4.3.13 之前，客户端使用某些密码套件时，EMQX 将无法成功握手并触发 `malformed_handshake_data` 异常。
- CentOS 8 Erlang 运行时系统在 RockyLinux 8 上重新构建。 `centos8` 将继续保留在包名中以保持向后兼容。

### 功能增强

- 规则引擎桥接数据到 Pulsar 新增对 Pulsar proxy 的支持。
- 为 Kafka 生产者增加 OOM 保护。
- 新增命令行接口 `emqx_ctl pem_cache clean`，允许强制清除 x509 证书缓存，以在证书文件更新后立即重新加载。
- 重构 ExProto，以便匿名客户端也可以显示在 Dashboard 上。
- 桥接中的主题配置项现在可以使用 `${node}` 占位符。
- 严格模式下新增对 MQTT 报文中的 UTF-8 字符串有效性检查。设置为 `true` 时，无效的 UTF-8 字符串将导致客户端连接断开。
- MQTT-SN 网关支持会话恢复时主动同步注册主题。
- 将规则引擎浮点型数据的写入精度从为小数点后 10 位提升至 17 位。
- EMQX 将在启动时提示如何修改 Dashboard 的初始密码。

### 错误修复

- 修复 `MQTT Subscriber` 模块无法使用双向 SSL 连接的问题。
- 修复 `PSKFile` 模块启动失败的问题。
- 修复 `Kafka 消费组` 模块无法处理二进制数据的问题。
- 修复日志追踪功能无法停止的问题。
- 修复规则引擎持久化数据到 Oracle 和 Lindorm 的动作（仅限同步操作）执行失败时无法触发备选动作的问题。
- 修复规则引擎数据持久化到 Oracle 失败但成功计数仍然增加的问题。
- 修复部分 zone 配置无法清除的问题。
- 修复部分监控告警配置的修改在重启后失效的问题。
- 修复编解码功能在集群环境下不可用的问题。
- 修复集群环境下 LwM2M 客户端列表查询 API 返回数据错误导致无法访问 LwM2M 网关模块管理页面的问题。
- 修复 JT/T 808 位置报告报文解析错误的问题。
- 修复 el8 安装包在 Amazon Linux 2022 上无法启动的问题，错误内容为 `errno=13 Permission denied`。
- 修复某些情况下如果连接进程阻塞，客户端无法重连的问题，现在等待超过 15 秒无响应将强制关闭旧的连接进程。
- 修复规则引擎资源不可用时查询资源请求超时的问题。
- 修复热升级运行失败后再次运行出现 `{error, eexist}` 错误的问题。
- 修复向不存在的主题别名发布消息会导致连接崩溃的问题。
- 修复通过 HTTP API 在另一个节点上查询 lwm2m 客户端列表时的 500 错误。
- 修复主题订阅的 HTTP API 在传入非法的 QoS 参数时崩溃的问题。
- 修复通过多语言协议扩展功能接入的连接进程异常退出时未释放相关资源导致连接计数不更新的问题。
- 修复 `server_keepalive` 配置项的值会被错误应用于 MQTT v3.1.1 客户端的问题。
- 修复 Stomp 客户端无法触发 `$event/client_connection` 事件消息的问题。
- 修复 EMQX 启动时系统内存告警误激活的问题。
- 修复向 MQTT-SN 客户端成功注册主题时没有重传此前因未注册主题而投递失败的消息的问题。
- 修复 `loaded_plugins` 文件中配置了重复的插件时 EMQX 启动输出错误日志的问题。
- 修复 MongoDB 相关功能在配置不正确时输出过量错误日志的问题。
- 增加对 Dashboard User 与 AppID 的格式检查，不允许出现 `/` 等特殊字符。
- 将踢除客户端时返回的 DISCONNECT 报文中的原因码更正为 `0x98`。
- 代理订阅将忽略为空的主题。

## 4.3.7 版本

*发布日期: 2022-02-11*

### 重要

我们在 4.3.7 中修复了 License 总连接数计算的 Bug，License 将正确地检查集群的总连接数，而非错误地仅检查每个节点上的连接数。

请计划升级的用户注意此变化可能导致的客户端达到 License 限制而无法连接的可能性。

### 增强

- license 连接数预警，默认连接数达到证书允许的 80% 则告警，小于 75% 时解除告警。用户也可在 `emqx.conf` 中进行自定义：`license.connection_high_watermark_alarm` , `license.connection_low_watermark_alarm`
- license 过期预警，当有效期小于 30 天时，会告警提示
- 规则引擎支持为客户端消息异常丢失事件配置规则与动作，以增强用户在这一场景的自定义处理能力
- 改进规则引擎 SQL 匹配执行过程中的相关统计指标
- 客户端模糊搜索支持 `*`， `(`，`)` 等特殊字符
- 改进 ACL 相关统计指标，解决命中 ACL 缓存导致计数不增加的问题
- Webhook 事件通知中新增 `connected_at` 字段
- 在因持有锁太久而终止客户端状态之前记录客户端状态

### 修复

- 修复数据导入导出在某些情况下不可用的问题
- Module 更新机制改进，解决更新失败后 Module 不可用的问题
- 修复规则引擎在执行比较大小的语句时候未进行类型检查的问题
- 修复更新规则引擎动作后相关计数清零的问题
- 修复 Metrics 接口默认情况下不返回 client.acl.deny 等认证鉴权指标的问题
- 修复订阅查询接口未返回分页数据的问题
- 修复 STOMP 处理 TCP 粘包时解析失败的问题
- 修复客户端过滤查询时会话创建时间选项不可用的问题
- 修复重启后内存告警可能不会触发的问题
- 修复 `emqx_auth_mnesia` 插件中存在用户数据时导入数据崩溃的问题

## 4.3.6 版本

*发布日期: 2021-12-17*

EMQX 4.3.6 现已发布，主要包含以下改动:

### 增强

- 规则引擎现已支持 Ali Lindorm 数据库
- 支持配置是否继续投递空的保留消息，以适应仍在使用 MQTT v3.1 协议的用户
- 优化内置访问控制文件模块的使用交互

### 修复

- 修复内存占用计算错误的问题
- 修复规则引擎 Webhook Action 的 Path 参数不支持使用 ${Variable} 的问题
- 修复 RocketMQ 异步写入时数据乱码的问题
- 修复 RocketMQ 统计指标不准的问题
- 修复某些情况下更新或删除 MQTT Bridge 和 MQTT Subscribe 资源，会持续打印连接失败日志的问题
- 修复规则引擎保存数据到 MySQL 时可能出现较高失败率的问题
- 修复规则引擎 Clickhouse 离线消息功能不可用的问题
- 修复规则引擎 MongoDB 离线消息功能中 Max Returned Count 选项无法使用的问题
- 修复部分热配置失效的问题

## 4.3.5 版本

*发布日期: 2021-11-05*

EMQX 4.3.5 现已发布，主要包含以下改动:

### 增强

- 改进客户端踢除机制
- 为 LwM2M 网关添加新加密套件的支持
- 支持优先级队列的交错（以避免低优先级队列枯竭）
- 默认为 HTTP 认证插件关闭超级用户请求
- 优化 InfluxDB 写入性能
- InfluxDB 的 Tag Name 与 Field Name 支持使用占位符

### 重要修复

- 修复集群间调用可能导致客户端进程失去响应的问题
- 修复 WebHook TLS 不可用的问题
- 修复 MongoDB 资源不支持域名的问题
- 修复基于内置数据库的 ACL 的性能问题
- 修复基于内置数据库的认证错误转码 HTTP 请求参数的问题
- 修复 MySQL 认证模块可能启动失败的问题
- 修复 STOMP 网关若干问题

### 次要修复

- 修复规则引擎 Kafka 和 MongoDB 资源状态不准确的问题
- 修复包含 “\” 字符的 Client ID 无法进行模糊搜索的问题
- 修复可变字节整数可能大于 4 字节的问题
- 修复可能添加重复模块的问题
- 修复无法在 Dashboard 上重启 Listener 的问题

## 4.3.4 版本

*发布日期: 2021-09-18*

### 增强

- 规则引擎 数据桥接到pulsar 支持数据压缩
- 延长创建规则的超时间隔

### 修复

- 规则引擎 数据保存到InfluxDB 性能问题
- WebHook 无法配置 sni 导致某些情况下无法使用 HTTPS 的问题
- 规则引擎 关闭规则后资源无法释放的问题
- 规则引擎 离线消息 在某些情况下接收后无法删除的问题

## 4.3.3 版本

*发布日期: 2021-08-16*

### 增强

- 离线消息保存到Redis 支持清除残留数据
- ExHook 增加自动重连机制，超时参数 和 备选动作

### 修复

- 规则引擎无法使用HTTPS 连接到 InfluxDB
- 规则引擎 数据保存到InfluxDB 动作无法使用占位符
- 规则引擎 数据桥接到WebServer 无法使用Path
- grpc-client 超时处理逻辑
- ExProto bug，增加重试逻辑，减少一些不必要的打印

## 4.3.2 版本

*发布日期: 2021-07-17*

### 增强

- 增强 客户端上/下线消息增加更多的字段

### 修复

- LwM2M网关 管理页面无法打开的问题
- JT/T808网关 解析位置上报中自定义字段无法解析的问题
- acl.conf 文件格式错误导致ACL规则失效的问题
- 创建 auth_ldap 认证模块失败的问题
- 多语言协议解析 异常情况下无法停止的问题
- 规则引擎 无法创建Oracle 资源的问题
- 规则引擎 同步批量写入到SQL Server失败的问题

## 4.3.1 版本

*发布日期: 2021-06-05*

### 增强

- 规则引擎 离线消息保存中 TimeRange 字段的说明

### 修复

- 规则引擎 数据保存到 OpenTSDB 异常情况下无法写入的问题
- 热升级后版本显示错误的问题
- MQTT-SN 协议 `cleansession=false` 的客户端在恢复 session 时 topicid 丢失的问题
- 预置模块在重启后修改配置丢失的问题
- Dashboard 规则引擎编辑显示错误问题
- Dashboard 导航面包屑显示问题

## 4.3.0 版本

*发布日期: 2021-05-19*

### 增强

- 规则引擎消息桥接到 Kafka 分区支持动态扩容
- 规则引擎支持 ClickHouse 离线消息与代理订阅
- 规则引擎中支持批量操作动作默认启用批量异步模式
- 规则引擎数据保存到 InfluxDB 重构以增强性能
- 模块 消息下发 Kafka 消费组支持配置 Payload 格式

### 修复

- 规则引擎动作编辑数据不一致问题
- Dashboard 模块翻译问题
- 规则引擎 SQL语句支持 null 函数，undefined 转成 null
